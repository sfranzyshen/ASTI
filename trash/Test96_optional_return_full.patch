--- a/ASTInterpreter.hpp
+++ b/ASTInterpreter.hpp
@@ -123,8 +123,10 @@
-    CommandValue lastExpressionResult_;
-    CommandValue returnValue_;
+    std::optional<CommandValue> lastExpressionResult_;
+    std::optional<CommandValue> returnValue_;
 
--- a/ASTInterpreter.cpp
+++ b/ASTInterpreter.cpp
@@ -210,7 +210,8 @@
-      lastExpressionResult_(std::monostate{}),
+      lastExpressionResult_(std::make_optional(CommandValue(std::monostate{}))),
 
-      returnValue_(std::monostate{}),
+      returnValue_(std::make_optional(CommandValue(std::monostate{}))),
@@ -950,7 +951,9 @@
-    returnValue_ = std::monostate{};
+    returnValue_.reset();
+    returnValue_.emplace(std::monostate{});
@@ -2605,11 +2608,23 @@
-    // Save return state to prevent corruption during nested calls
-    bool savedShouldReturn = shouldReturn_;
-    CommandValue savedReturnValue = returnValue_;
-    shouldReturn_ = false;
-    returnValue_ = std::monostate{};
-
-    // ... function execution ...
-
-    // Restore previous return state
-    shouldReturn_ = savedShouldReturn;
-    returnValue_ = savedReturnValue;
+    // Save return state to prevent corruption during nested calls (safe optional version)
+    bool savedShouldReturn = shouldReturn_;
+    std::optional<CommandValue> savedReturnValue;
+    if (returnValue_.has_value()) {
+        savedReturnValue.emplace(std::move(returnValue_.value()));
+    }
+    shouldReturn_ = false;
+    returnValue_.reset();
+    returnValue_.emplace(std::monostate{});
+
+    // ... function execution ...
+
+    // Restore previous return state
+    shouldReturn_ = savedShouldReturn;
+    if (savedReturnValue.has_value()) {
+        returnValue_ = std::move(savedReturnValue.value());
+    } else {
+        returnValue_.reset();
+        returnValue_.emplace(std::monostate{});
+    }
